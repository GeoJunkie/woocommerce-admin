{"version":3,"sources":["webpack://wc.[modulename]/./client/profile-wizard/steps/usage-modal.js","webpack://wc.[modulename]/./client/task-list/tasks/payments/wcpay-usage-modal.js"],"names":["UsageModal","props","state","isLoadingScripts","isRequestStarted","prevProps","prevState","hasErrors","isRequesting","onClose","onContinue","createNotice","isRequestSuccessful","isRequestError","__","allowTracking","updateOptions","window","wcTracks","enable","setState","_isMounted","isEnabled","trackingValue","woocommerce_allow_tracking","title","message","interpolateComponents","mixedString","components","link","dismissActionText","acceptActionText","isBusy","isDismissible","updateTracking","Component","compose","withSelect","select","OPTIONS_STORE_NAME","getOption","getOptionsUpdatingError","isOptionsUpdating","Boolean","withDispatch","dispatch","WCPayUsageModal","query","getQuery","shouldDisplayModal","useState","isOpen","setIsOpen","closeModal","updateQueryString","undefined","trackingMessage"],"mappings":"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","file":"chunks/wcpay-usage-modal.min.js","sourcesContent":["/**\n * External dependencies\n */\nimport { __ } from '@wordpress/i18n';\nimport { Component } from '@wordpress/element';\nimport { compose } from '@wordpress/compose';\nimport { withDispatch, withSelect } from '@wordpress/data';\nimport interpolateComponents from 'interpolate-components';\nimport { Button, Modal } from '@wordpress/components';\nimport { Link } from '@woocommerce/components';\nimport { OPTIONS_STORE_NAME } from '@woocommerce/data';\n\nclass UsageModal extends Component {\n\tconstructor( props ) {\n\t\tsuper( props );\n\t\tthis.state = {\n\t\t\tisLoadingScripts: false,\n\t\t\tisRequestStarted: false,\n\t\t};\n\t}\n\n\tasync componentDidUpdate( prevProps, prevState ) {\n\t\tconst {\n\t\t\thasErrors,\n\t\t\tisRequesting,\n\t\t\tonClose,\n\t\t\tonContinue,\n\t\t\tcreateNotice,\n\t\t} = this.props;\n\t\tconst { isLoadingScripts, isRequestStarted } = this.state;\n\n\t\t// We can't rely on isRequesting props only because option update might be triggered by other component.\n\t\tif ( ! isRequestStarted ) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst isRequestSuccessful =\n\t\t\t! isRequesting &&\n\t\t\t! isLoadingScripts &&\n\t\t\t( prevProps.isRequesting || prevState.isLoadingScripts ) &&\n\t\t\t! hasErrors;\n\t\tconst isRequestError =\n\t\t\t! isRequesting && prevProps.isRequesting && hasErrors;\n\n\t\tif ( isRequestSuccessful ) {\n\t\t\tonClose();\n\t\t\tonContinue();\n\t\t}\n\n\t\tif ( isRequestError ) {\n\t\t\tcreateNotice(\n\t\t\t\t'error',\n\t\t\t\t__(\n\t\t\t\t\t'There was a problem updating your preferences',\n\t\t\t\t\t'woocommerce-admin'\n\t\t\t\t)\n\t\t\t);\n\t\t\tonClose();\n\t\t}\n\t}\n\n\tupdateTracking( { allowTracking } ) {\n\t\tconst { updateOptions } = this.props;\n\n\t\tif ( allowTracking && typeof window.wcTracks.enable === 'function' ) {\n\t\t\tthis.setState( { isLoadingScripts: true } );\n\t\t\twindow.wcTracks.enable( () => {\n\t\t\t\t// Don't update state if component is unmounted already\n\t\t\t\tif ( ! this._isMounted ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.setState( { isLoadingScripts: false } );\n\t\t\t} );\n\t\t} else if ( ! allowTracking ) {\n\t\t\twindow.wcTracks.isEnabled = false;\n\t\t}\n\n\t\tconst trackingValue = allowTracking ? 'yes' : 'no';\n\t\tthis.setState( { isRequestStarted: true } );\n\t\tupdateOptions( {\n\t\t\twoocommerce_allow_tracking: trackingValue,\n\t\t} );\n\t}\n\n\tcomponentDidMount() {\n\t\tthis._isMounted = true;\n\t}\n\n\tcomponentWillUnmount() {\n\t\tthis._isMounted = false;\n\t}\n\n\trender() {\n\t\t// Bail if site has already opted in to tracking\n\t\tif ( this.props.allowTracking ) {\n\t\t\tconst { onClose, onContinue } = this.props;\n\t\t\tonClose();\n\t\t\tonContinue();\n\t\t\treturn null;\n\t\t}\n\n\t\tconst {\n\t\t\tisRequesting,\n\t\t\ttitle = __( 'Build a better WooCommerce', 'woocommerce-admin' ),\n\t\t\tmessage = interpolateComponents( {\n\t\t\t\tmixedString: __(\n\t\t\t\t\t'Get improved features and faster fixes by sharing non-sensitive data via {{link}}usage tracking{{/link}} ' +\n\t\t\t\t\t\t'that shows us how WooCommerce is used. No personal data is tracked or stored.',\n\t\t\t\t\t'woocommerce-admin'\n\t\t\t\t),\n\t\t\t\tcomponents: {\n\t\t\t\t\tlink: (\n\t\t\t\t\t\t<Link\n\t\t\t\t\t\t\thref=\"https://woocommerce.com/usage-tracking\"\n\t\t\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\t\t\ttype=\"external\"\n\t\t\t\t\t\t/>\n\t\t\t\t\t),\n\t\t\t\t},\n\t\t\t} ),\n\t\t\tdismissActionText = __( 'No thanks', 'woocommerce-admin' ),\n\t\t\tacceptActionText = __( 'Yes, count me in!', 'woocommerce-admin' ),\n\t\t} = this.props;\n\n\t\tconst { isRequestStarted } = this.state;\n\t\tconst isBusy = isRequestStarted && isRequesting;\n\n\t\treturn (\n\t\t\t<Modal\n\t\t\t\ttitle={ title }\n\t\t\t\tisDismissible={ this.props.isDismissible }\n\t\t\t\tonRequestClose={ () => this.props.onClose() }\n\t\t\t\tclassName=\"woocommerce-usage-modal\"\n\t\t\t>\n\t\t\t\t<div className=\"woocommerce-usage-modal__wrapper\">\n\t\t\t\t\t<div className=\"woocommerce-usage-modal__message\">\n\t\t\t\t\t\t{ message }\n\t\t\t\t\t</div>\n\t\t\t\t\t<div className=\"woocommerce-usage-modal__actions\">\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tisSecondary\n\t\t\t\t\t\t\tisBusy={ isBusy }\n\t\t\t\t\t\t\tonClick={ () =>\n\t\t\t\t\t\t\t\tthis.updateTracking( { allowTracking: false } )\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{ dismissActionText }\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tisPrimary\n\t\t\t\t\t\t\tisBusy={ isBusy }\n\t\t\t\t\t\t\tonClick={ () =>\n\t\t\t\t\t\t\t\tthis.updateTracking( { allowTracking: true } )\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t{ acceptActionText }\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</Modal>\n\t\t);\n\t}\n}\n\nexport default compose(\n\twithSelect( ( select ) => {\n\t\tconst {\n\t\t\tgetOption,\n\t\t\tgetOptionsUpdatingError,\n\t\t\tisOptionsUpdating,\n\t\t} = select( OPTIONS_STORE_NAME );\n\n\t\tconst allowTracking =\n\t\t\tgetOption( 'woocommerce_allow_tracking' ) === 'yes';\n\t\tconst isRequesting = Boolean( isOptionsUpdating() );\n\t\tconst hasErrors = Boolean( getOptionsUpdatingError() );\n\n\t\treturn {\n\t\t\tallowTracking,\n\t\t\tisRequesting,\n\t\t\thasErrors,\n\t\t};\n\t} ),\n\twithDispatch( ( dispatch ) => {\n\t\tconst { createNotice } = dispatch( 'core/notices' );\n\t\tconst { updateOptions } = dispatch( OPTIONS_STORE_NAME );\n\n\t\treturn {\n\t\t\tcreateNotice,\n\t\t\tupdateOptions,\n\t\t};\n\t} )\n)( UsageModal );\n","/**\n * External dependencies\n */\nimport { __ } from '@wordpress/i18n';\nimport { useState } from '@wordpress/element';\nimport { getQuery, updateQueryString } from '@woocommerce/navigation';\nimport interpolateComponents from 'interpolate-components';\nimport { Link } from '@woocommerce/components';\n\n/**\n * Internal dependencies\n */\nimport UsageModal from '../../../profile-wizard/steps/usage-modal';\n\nconst WCPayUsageModal = () => {\n\tconst query = getQuery();\n\tconst shouldDisplayModal = query[ 'wcpay-connection-success' ] === '1';\n\tconst [ isOpen, setIsOpen ] = useState( shouldDisplayModal );\n\n\tif ( ! isOpen ) {\n\t\treturn null;\n\t}\n\n\tconst closeModal = () => {\n\t\tsetIsOpen( false );\n\t\tupdateQueryString( { 'wcpay-connection-success': undefined } );\n\t};\n\n\tconst title = __(\n\t\t'Help us build a better WooCommerce Payments experience',\n\t\t'woocommerce-admin'\n\t);\n\tconst trackingMessage = interpolateComponents( {\n\t\tmixedString: __(\n\t\t\t'By agreeing to share non-sensitive {{link}}usage data{{/link}}, you’ll help us improve features and optimize the WooCommerce Payments experience. You can opt out at any time.',\n\t\t\t'woocommerce-admin'\n\t\t),\n\t\tcomponents: {\n\t\t\tlink: (\n\t\t\t\t<Link\n\t\t\t\t\thref=\"https://woocommerce.com/usage-tracking\"\n\t\t\t\t\ttarget=\"_blank\"\n\t\t\t\t\ttype=\"external\"\n\t\t\t\t/>\n\t\t\t),\n\t\t},\n\t} );\n\n\treturn (\n\t\t<UsageModal\n\t\t\tisDismissible={ false }\n\t\t\ttitle={ title }\n\t\t\tmessage={ trackingMessage }\n\t\t\tacceptActionText={ __( 'I agree', 'woocommerce-admin' ) }\n\t\t\tdismissActionText={ __( 'No thanks', 'woocommerce-admin' ) }\n\t\t\tonContinue={ closeModal }\n\t\t\tonClose={ closeModal }\n\t\t/>\n\t);\n};\n\nexport default WCPayUsageModal;\n"],"sourceRoot":""}